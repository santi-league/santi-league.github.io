# 牌谱管理说明

## 功能概述

新的牌谱管理系统会自动将牌谱文件按日期整理到子文件夹中，方便管理和查找。

## 工作流程

### 1. 添加新牌谱

只需将新的牌谱JSON文件放到对应的文件夹根目录：
- M-League牌谱 → `game-logs/m-league/`
- EMA牌谱 → `game-logs/ema/`

例如：
```
game-logs/m-league/
  ├── 11_22_2025_Tounament_South.json  ← 新牌谱直接放这里
  ├── 11_22_2025_Tounament_South (1).json
  └── ...
```

### 2. 自动整理

运行网站生成脚本时，会自动整理牌谱：

```bash
./generate_website.sh
```

执行的操作：
1. **步骤 1/3**: 整理牌谱文件（按日期归档）
2. **步骤 2/3**: 提取荣誉牌谱
3. **步骤 3/3**: 生成网站页面

### 3. 整理后的结构

牌谱会被：
1. 移动到以日期命名的子文件夹中（格式：`YYYY-MM-DD`）
2. 重命名为：`日期_时间_第一名玩家id.json`

```
game-logs/m-league/
  ├── 2025-08-01/
  │   ├── 2025-08-01_004121_小地鼠爱点炮.json
  │   └── 2025-08-01_221519_santi.json
  ├── 2025-08-02/
  │   └── 2025-08-02_000053_RinshanNomi.json
  ├── 2025-11-21/
  │   ├── 2025-11-21_003230_姫野婭也.json
  │   └── 2025-11-21_012042_小地鼠爱点炮.json
  └── 2025-11-22/
      └── 新牌谱.json  ← 新文件直接放这里，运行时自动整理并重命名
```

**文件名格式说明**：
- `2025-08-01`：日期（YYYY-MM-DD）
- `221519`：时间（HHMMSS，24小时制，22:15:19）
- `santi`：获得第1位的玩家id

## 手动整理

如果只想整理牌谱而不生成网站，可以单独运行：

```bash
# 预览整理效果（不实际移动文件）
python src/organize_logs.py --dry-run

# 实际执行整理
python src/organize_logs.py
```

## 日期来源

牌谱的日期从JSON文件的 `title[1]` 字段中读取：

```json
{
  "title": [
    "Tounament South: 36652178",
    "11/22/2025, 12:00:00 AM"  ← 使用这个时间戳
  ],
  ...
}
```

时间戳格式：`MM/DD/YYYY, HH:MM:SS AM/PM`

## 注意事项

1. **递归检查所有文件**
   - 脚本会递归扫描所有子文件夹中的JSON文件
   - 检查每个文件是否在正确的日期文件夹中
   - 检查文件名是否符合新的命名格式
   - 自动重命名不符合格式的文件

2. **文件操作类型**
   - **移动**：文件不在正确的日期文件夹中
   - **重命名**：文件在正确文件夹中，但文件名格式不对
   - **跳过**：文件已经在正确位置且文件名正确

3. **时间戳必须存在**
   - 如果牌谱文件缺少时间戳，会报错并跳过
   - 确保所有牌谱都包含有效的 `title[1]` 字段

4. **自动递归扫描**
   - 网站生成时会自动扫描所有子文件夹
   - 无需担心整理后找不到牌谱

## 优势

- ✅ **自动化**：运行 `./generate_website.sh` 时自动整理
- ✅ **有序管理**：牌谱按日期分组，便于查找
- ✅ **零配置**：新牌谱直接放根目录即可
- ✅ **向后兼容**：现有代码自动支持子文件夹扫描
